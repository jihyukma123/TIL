# [Gasip] 로그아웃 후 다른 아이디로 로그인 시 토큰값 업데이트 되지 않는 이슈 해결하는 과정에서 배운 점

프로젝트를 만들어서 테스트 하던 중 로그아웃 한 다음에 다시 로그인 했을 때 앞서 로그아웃 했던 계정의 토큰이 남아있어 글 목록 등이 이전 유저의 토큰값 기준으로 표시되는 문제가 있었음.

Gasip 프로젝트에서는 거의 모든 요청에 대해서 토큰을 포함해서 요청을 보내야했기 때문에, axios의 인스턴스를 토큰값을 포함하는 형태로 만들고, 이 인스턴스를 재활용해서 백엔드에 요청을 보내는 함수들을 구현하였다.

당연히 로그아웃을 한 다음에 다른 아이디로 로그인을 하면 새로 로그인한 유저의 토큰으로 요청이 가도록 axios인스턴스가 업데이트 되어야 했다.

먼저 내가 이를 구현한 방식은 axios의 `create`함수에 header의 Authorization키값으로 전달하는 userToken을 같은 모듈(파일) 내에 let 변수로 선언하고, 로그인 시 이 let 변수를 업데이트 하는 형식으로 구현하였다.

그리고 나서 잘못된 방식으로 테스트를 해서 이게 잘 처리된다고 생각하였음.

당연히 이 userToken값이 null로 처리되었다가 새롭게 받은 값으로 업데이트 되면 axios인스턴스의 값이 이대로 처리될 것이라고 생각해서, userToken값이 잘 업데이트 되는지만 확인하였다.

그런데 진짜 문제는 이 포인트가 아니었음.

애초에 해당 모듈에서 axios.create함수가 한 번 실행되어서 생성된 객체가 업데이트 되지 않는 것이 문제였다.

그래서 로그인을 다시 해서 userToken값을 업데이트 해도 정작 객체 자체는 이전의 값으로 이미 생성되어 있는 상태라서 기존 유저의 토큰으로 요청한 데이터가 표시되고 있었던 것이다.

이를 해결하기 위해서 자료조사를 해보니, 생성된 객체의 `AxiosInstance.defaults.headers`에 접근해서 내가 기존에 할당했던 값을 업데이트 하는 방법으로 토큰값을 업데이트 할 수 있었다.

이렇게 처리하니 잘 해결된 것으로 보인다.

앱이 실행된 이후에 해당 모듈의 값들이 어떻게 처리되는지에 대한 이해가 조금 더 있었더라면 문제를 더 빨리 풀었을 수 있을 것 같다.

최근에 공부한 내용 중에, JavaScript ES6모듈(파일이 곧 모듈인 현재의 형태)은 최초로 해당 모듈의 값이 import될 때 실행되어서 초기화된다고 기억하고 있는데, 이 관련해서 자료를 잘 못찾았다. 다시 업데이트가 필요함.
