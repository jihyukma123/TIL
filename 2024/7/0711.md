# RN앱에서 글로벌하게 사용될 fontFamily값을 설정하는 과정에서 했던 고민들, 그리고 관련해서 배운 점.

RN앱이 실행되면, 다음 단계를 거친다.

Bootsplash 표시(네이티브 단에서 구현된다. 왜냐하면 이게 JavaScript단에서 이루어지지 않기 때문이다.)

JavaScript 스레드를 활성화하려면, 결국 Native스레드가 먼저 실행되어야 하는데 이 Native Thread -> JavaScript 스레드로 이동하는 시점에서 빈 화면이 보이기 때문에 Native 단에서 표시될 이미지를 설정하고, 이를 비활성화(hide)할 수 있는 API를 JavaScript 단에 노출시켜서 앱이 로딩되는데 필요한 코드 실행이 완료된 시점에 hide를 해서 가리는 방법으로 사용된다.

Bootsplash가 가려지는 시점 전에 사실 앱 렌더링은 이미 이루어져있다.

조건은 아래와 같음.

- 앱을 실행한 후에 DB를 확인해서 설정된 언어값이 있다면 해당 언어값을 기준으로 처리하고, 아니면 시스템 언어를 기준으로 처리해야함
- CustomFont 컴포넌트에서 언어를 기준으로 설정된 static한 fontFamily라는 값을 참조해서 fontFamily를 렌더링해야함
- fontFamily값 조건
  - 글로벌하게 참조가능해야 한다.
  - 한 번 설정되면 앱 lifecycle동안 바뀔 일이 없는 값이다.
  - 하나의 컴포넌트에서만 사용된다.(커스텀 폰트 컴포넌트.)

이렇게 처리하기 위해서 어떻게 해야될까?

별도 폰트 관련을 기능을 모아둔 모듈이 필요할까?

fontFamily라는 static한 값은 어떻게 처리되어야 할까?

등등 의문들을 하나씩 처리하였음.

## 시도1. 가장 먼저 떠오른 방법을 시도

가장 간단한 방법은 특정 값을 설정해두고, getFontFamily등 함수가 실행된 값을 할당하는 것이다.

예를 들면

```javascript
// fontFamily라는 값을 어딘가에 선언하고,
let fontFamily = "";

// 앱 시작 시 fontFamily를 set한다. 언어에 따라서.
function setFontFamily(language) {
  fontFamily = "someFont";
}

// 그리고 이 값을 참조할 수 있는 함수를 만들어서 이를 style의 fontFamily값에 할당한다.

export function getFontFamily() {
  return fontFamily;
}

// 함수를 import해서 커스텀 폰트 컴포넌트에서 사용
style = {
  fontFamily: getFontFamily(),
};
```

가장 간단하고 직관적인 방법이라고 생각했다.

다만 이 방법에서 내가 마음에 안드는 부분이 있었는데, 컴포넌트 안에서 getFontFamily()라는 함수를 호출해서 값을 할당하는 형태로 구현하면, fontFamily라는 값이 호출되는 시점이나 컨텍스트와 무관하게 동일하는 값을 반환하는 함수인데 계속 호출되는 것이 문제라고 판단하였다.

이것은 2가지 점에서 문제라고 인식했는데,

1. 폰트 컴포넌트는 정말 여러 군데서 사용되는데 매번 같은 값을 얻기 위해서 함수를 호출한다는게 불필요한 동작으로 느껴짐.
2. 다른 어떤 방법들이 있을지 딱 떠오르지 않음. 즉 방법별로 장단을 인지한 상태에서 적절한 해답을 선택하는게 아니라 습관적으로 작성하던 코드임.

그래서 이 문제를 개선하려고 다음 생각의 흐름단계로 넘어가게 되었음.

### 어떻게 함수가 불필요하게 여러 번 호출되는 것을 방지할 수 있을까?

가장 먼저 떠오른 방법은 컴포넌트 밖으로 함수 호출을 빼서, 컴포넌트 글로벌 scope에 선언한 변수에 할당하고 해당 변수를 사용하는 것이었다.

시도해본 결과, 당연히 함수 호출 자체는 한 번만 되지만 문제는 함수 호출 타이밍이 내가 원하는 타이밍이 아니었다는 점이다.

내가 생각했을 때 내가 원하는 흐름은 다음과 같다.

앱이 실행됨 -> useEffect의 init이 실행 -> useEffect안에서 처리된 language값을 활용해서 글로벌 폰트 값 set
-> 컴포넌트 글로벌 font 참조함수 실행 -> 값 할당 -> 할당된 값을 컴포넌트에서 참조

이런 순서로 실행되는게 필요했는데, 정작 호출되는 방식은 다음과 같았다.

컴포넌트 글로벌 스코프에서 참조함수 실행(이 시점에 글로벌 영역에 선언한 변수에는 이미 함수 호출의 결과값인 default 값이 할당됨) -> useEffect의 init실행 -> language set하는 함수 실행

여기서 문제는, 컴포넌트에 선언한 변수가 함수가 다시 호출되지 않으니까 값이 초기에 호출된 결과값인, 아직 set 함수가 실행되기 전의 초기값이 남아있었다.

그래서 이렇게만 해서는 문제가 해결되지 않았음.

컴포넌트 밖 영역에서 함수를 한 번만 호출해서 할당된 값을 활용하려면 다른 메커니즘이 필요하다.

### 어떻게 시점이 어긋나는 문제를 해결하고, 업데이트 된 값을 잘 참조하도록 할 수 있을까?

내가 생각했을 때, 방법이 2가지 있었다.

1.  state management를 이용한다. like zustand
2.  컴포넌트 밖에 선언한 변수가 특정 변수를 직접 참조하는? 해당 값이 변경되었을 때 그 참조에 의해서 값 변경이 반영되도록 하는 구조를 만든다.

나는 이 문제를 해결하기 위해서 zustand를 사용하고 싶지 않았다. 왜냐하면 이 값은 한 번 설정되면 다시 변경될 일이 없었기 때문에, 굳이 store를 하나 만들어서 값을 저장할 필요가 없다고 생각했기 때문이다.

그래서 2번째 방법인, 특정 변수를 고정으로 선언하고 해당 변수를 직접 참조할 수 있는 메커니즘을 만드는 방향으로 가야겠다고 결론을 내렸다.
