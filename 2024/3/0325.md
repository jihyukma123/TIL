# JavaScript Date 관련 이슈

동일한 날짜 값에 대해서, 요일이 잘못 찍히는 이슈가 있어 원인을 알아보았다.

## 현상

```javascript
const day = new Date("2024-03-22");
const dayNumber = day.getDay();

// 위 코드에서 시스템 날짜 및 시간 설정에 따라 dayNumber 값이 달라짐
```

## 원인 파악 과정

`getDay()`함수의 결과값이 다른 것으로 파악하고 거기에서 부터 추적을 시작함.

`getDay()`함수는 호출된 **local time**을 기준으로 일주일의 요일에 해당되는 숫자를 반환한다.

0이 일요일이고, 6이 월요일인건 고정이다.

즉 `getDay()`함수를 호출한 시간 객체의 local time값을 기준으로 날짜를 반환한다는 건데..

그러면 day 값에 어떤 값이 저장되었는지 알아야 한다.

찾아보니, new Date에 '2024-03-22'와 같은 `date-only` 형태를 전달하면..`date-only forms are interpreted as a UTC time` 이라고 한다.

여기서 약간 이해가 어려웠는데, `new Date('2024-03-22')`에 할당된 시간 값이 UTC기준으로 저장되었다는 의미이다. 그리고 이 때 저장되는 값인 UTC기준 3월 22일 자정이다.

그리고 앞서서 `getDay()`함수는 local time을 기준으로 처리된다고 하였다. 즉, UTC기준으로 3월 22일 자정일 때, local time은 몇시인지를 기준으로 날짜가 계산된다.

그렇다는건, UTC기준으로 더 느린 시간대에 속하는 타임존이 로컬 시간인 경우 나는 분명히 3월 22일로 요일을 구했다고 생각하는데 실상은 3월 21일 기준으로 요일이 구해진 것이다.

## 해결책

내 생각에는 요일만 구하고자 한다면 전달되는 형식에 관계없이 `getUTCDay()`함수를 사용하는게 더 안전하겠다.

아니면 같은 로직에 대해서 `moment('2023-03-22').day()` 형식으로 처리해도 되기는 한다. 그런데 이 방법도 조금 불안한게 아래 같은 상황에서는 JavaScript가 원래 동작하는 방식과 동일하게 동작한다.

```javascript
const day = new Date("2024-03-22");

const dayNumber = moment(day).day();
```

## JavaScript 날짜를 다룰 때 생각을 하면서 다뤄야 하는구나.

JavaScript가 날짜와 관련해서 얽힌 히스토리도 인지하고, 날짜를 다룰 때 주의가 필요하다는 사실을 알고 사용하는게 좋겠다.
