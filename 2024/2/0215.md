# 안드로이드 이슈

원인은 배터리 최적화였다... 배터리 최적화에서 최적화로 설정되어 있는 경우 이런 현상이 발생할 수 있다고 한다.

답을 찾기 전까지는 자료도 찾기 어려웠고, 진짜 아예 답을 모르겠다 싶었는데 답을 찾고보니 많은 사람들이 이미 당연히 의심했을 부분이었을지도 모르겠다는 생각이 들었다.

예전에 애플워치 프로젝트 했을 때, 갑자기 picker가 버벅거려서 원인을 한참 찾았었는데 그 때도 이런 os 환경 관련 이슈였다.

코드 자체의 문제 말고도 앱이 돌아가는 OS환경에 대해서 이해를 하고 필요에 따라 원하는대로 앱이 동작하도록 하는 것이 필요하겠다.

특히 안드로이드나 iOS 메이저 버전 변경 될때마다 업데이트 되는 내용은 꼭 follow up하고 앱에 어떤 영향이 있을지 미리 알아봐야겠다.

# 안드로이드 네이티브 모듈

배터리 최적화 관련 처리를 하기 위해서 혹시 해서 안드로이드 네이티브 모듈을 생성하는 방법과, 관련해서 Java 나 Kotlin공부가 필요하다.

## 네이티브 모듈 추가하는 방법

- `android/app/src/main/java/com/app-package-name` 에 원하는 모듈 파일 생성 ( MyModule.java or MyModule.kt )
- 원하는 모듈 작성
- MyAppPackage 파일 생성 ( 모든 패키지 이름 )
- Android 에서 네이티브 모듈을 사용하려면 React Native 에 등록(?)이 되어야 한다고 함
  - 네이티브 모듈을 ReactPackage 에 추가한 후에 해당 ReactPackage 등록해야 한다.
  - RN은 등록된 각 패키지에 loop over 하면서 각 패키지의 모듈들을 등록함
    - RN은 `createNativeModules()` 함수를 ReactPackage에 호출해서 등록할 모듈 목록을 가져온다. 여기서 처리돼서 초기화 되지 않은 모듈은 JavaScript에 노출되지 않는다.
    - ReactPackage 에 네이티브 모듈을 추가하기 위해서는, ReactPackage를 구현한 MyAppPackage.java or MyAppPackage.kt 라는 파일을 같은 디렉토리 내에 생성해야 한다.

네이티브단 코드에 접근할 수 있는 파일을 만들고, 해당 파일에 선언된 메서드를 JavaScript에 노출시켜서 JavaScript단에서 해당 메서드를 호출해서 원하는 기능을 처리하는 형식으로 이해하였음.

# 배터리 최적화 옵션 선택 여부를 확인하는 메서드를 구현하기 위해서 필요한 사항들

`notifee` 라이브러리에 구현되어 있는 내용을 토대로 코드를 이해해보고, 내게 필요한 방식으로 적용해보려고 한다.

수행되어야 하는 작업 자체는 간단함.

> 현재 앱에 배터리 최적화 옵션이 적용되어 있는지 파악한다.

필요한 코드

- 현재 앱을 구분지어서 쿼리할 방법이 필요하다.

  - 그냥 호출하면 자동으로 현재 앱의 설정으로 처리되는지?
  - 아니면 현재 앱의 어떤 identifier를 전달해서 조회해야 하는지?
  - 그렇다면 현재 앱의 identifier는 어떻게 구하는지?

- 배터리 최적화 옵션을 확인할 수 있는 방법을 찾아야 한다.

- 해당 기능을 처리하는 모듈을 작성하고 JavaScript에서 호출될 수 있는 함수를 구현해야 한다.
