# 오늘 업무하면서 문득 깨닫고 곱씹었던 내용들

## 통합적으로 앞단을 보는 눈이 있을수록 완성도에 도움이 된다.

앱에 추가되는 기능에 위치 정보가 필요해서 맡아서 자료조사를 하는 과정에서 새롭게 깨달은 점이 있어서 정리해둔다.

작업 단위를 크게 몇 가지로 나눠서 진행했다.

오늘 진행한 작업은 `RN앱에서 사용자 위치를 확인하는 방법 조사 및 테스트`였다.

조사해본 결과 `@react-native-community/geolocation` 라이브러리를 사용해서 위치 정보를 받아오는 것이 좋겠다고 판단하였다.(리액트 네이티브 공식문서에서 추천하는 라이브러리라서 채택하였음.) 라이브러리를 설치한 이후에 iOS/Android 별로 필요한 권한설정 코드를 추가하고, 실제로 권한 요청 함수 실행 시 요청이 되는지 그리고 권한을 받은 다음에 현재 위치가 잘 조회되는지 정도까지만 체크하였다.

아마 예전 같았으면 여기까지 체크하고 팀에 공유했을 것 같다. (이 라이브러리를 이러한 이유로 사용하면 될 것 같고, 문제없이 동작하는 것 확인했습니다. + 간단한 시연 정도?)

그런데 근래에 일을 조금 더 잘 하려면, 제대로 하려면 어떻게 해야될까 하는 생각을 하고 있었다.

그 일환으로 오늘도 문득 더 보완할 점이나 놓친 부분이 없을까에 대해서 고민해보았다.

문득 이런 생각이 들었다. `유저가 권한을 주지 않는 경우에는 어떡하지?`

그래서 플랫폼별로 권한을 요청했을 때 거절하면 어떻게 되는지 조사해본 결과, 무조건 이 케이스를 고려했어야 한다는 것을 깨달았다.

그래서 각 플랫폼 별로 권한 관련 기능이 동작하는 원리도 같이 파악해서 정리하였고, 유명한 다른 앱들이 권한이 없을 때 플랫폼 별로 어떻게 처리하는지도 같이 참고해서 정리하였다.

저번에 PG결제 기능을 붙일 때도 생각했던 건데, 기능을 구현할 때 의외로 구현 자체는 간단하지만 생각했던 flow대로 동작하지 않는 경우를 고려하지 않으면 치명적인 기능들이 있다.

PG결제 기능 구현할 때 가장 신경썼던 부분이 모종의 이유로 결제나 환불 등 돈을 처리하는 과정이 실패하는 케이스에 대한 처리였다. 이 때 안되는 케이스에 대해서 많이 고민했던게 여기로 이어지지 않았나 싶다.

앞으로는 이런 기능들은 당연하고, 전체적인 flow에서 의도한대로 동작하지 않는 케이스도 고려하는 시야와 경험을 기르자.

특히나 스타트업에서 일하는 개발자는 더더욱 이런 부분을 고려해야된다고 생각한다. 누군가가 빼먹으면 내가 그 부분을 채워서 완성도를 높인다는 생각. 뭔가 필요하면 내가 한다는 생각.

## 액션은 최대한 계산으로, 계산은 최대한 데이터로 변경하면 좋다는 함수형 원칙을 직접 체험했다.

오늘 팀원이 짠 코드를 리뷰하던 중, 실제로 함수형 원칙을 적용해서 개선한 케이스가 있어서 이에 대해 생각해본 사고흐름에 대해서 정리해둔다.

최근에 `쏙쏙 들어오는 함수형 코딩`이라는 책에서 코드를 액션/계산/데이터로 분류하고 가능하면 액션을 계산으로, 그리고 계산을 데이터로 변경하는 것이 더 좋은 코드(책의 의견에 따르면)라는 내용을 공부했었다. 오늘 이 함수형 원칙 중 계산을 데이터로 변경하는 원칙을 적용해서 실제로 코드 개선을 경험했다.

팀원이 짠 코드에서 버그가 발생했는데, 원인은 특정 객체에 추가되어야 하는 값이 누락된 것이었다.

유저가 특정 input을 작성하지 않으면 객체에 빈 문자열을 추가하는 형태로 구현하였는데, 이 빈 문자열을 추가하는 걸 빼먹어서 나중에 특정 데이터가 보이지 않았다.

이 코드를 보면서 `나중에 빈 문자열을 추가하는게 아니라, 앞단에서 데이터 원형을 만들 때 미리 빈 문자열을 값으로 갖는 key-value를 가진 객체로 데이터를 만드는게 더 나은 방법이 아닐까` 하는 생각이 들었다.

즉, 미리 데이터를 구성할 때 최종 형태의 원형처럼 만들고, 유저가 입력한 값이 있다면 빈 문자열을 유저가 입력한 값으로 업데이트 하는게 더 나은 코드라고 판단했다.

내가 생각했을 때 이러면 필요한 경우에 빈 문자열을 후행적으로 추가하는 방법과 비교해서 다음과 같은 장점이 있다.

- 미리 데이터의 형식을 볼 수 있다.
  - 나중에 코드를 보는 사람이 해당 UI의 데이터에 해당하는 부분의 전체적인 구조를 미리 한 눈에 볼 수 있다. 여기저기 돌아다니면서 객체 구조를 파악할 필요 없이, 데이터가 변경되는 흐름을 파악하기만 하면 된다. 그리고 적절한 변수명을 활용해서 값을 빈 문자열로 할당하면 자연스럽게 아 이정도에서 이 값이 입력되는 값으로 업데이트 되겠구나 하는 부분이 추측가능할 것 같다.
- 휴먼 에러가 발생할 가능성이 더 낮다.
  - 빈 문자열을 나중에 추가하는 코드는 추후 수정 시 맥락에 대한 이해를 요구한다. 최근에 토스에서 기획한 모닥불이라는 컨텐츠를 보면서 기억에 남았던 코드 관련 내용 중 하나가 바로 `코드에서 맥락 들어내기` 였다. 최근에 코드를 작성하면서 최대한 신경쓰는데 잘 안되는 부분이기도 하다. 이 맥락을 이해하지 못하고 코드를 수정하면 팀원이 값을 누락해서 버그가 발생했던 것처럼 동일한 버그가 발생할 수 있다. 반대로 애초에 데이터 구조를 잡아두면, 이 값이 어디서 어떻게 업데이트 되는지만 확인하면 된다. 만약에 이 데이터가 입력되어서 출력되는 파이프라인이라고 치면, 들어갔던 데이터가 나올 때도 동일한 구조이고 값만 달라지리라 기대하고 예측해서 코드를 이해하고 수정하는 것이 더 편하다. 파이프라인 중간에 없던 값이 생기고, 아니면 있던 값이 없어지고 한다면 결과값이 뭐가 될지 예측 가능성이 떨어진다.

이런 생각을 하면서 문득 내가 예전에 구현했던 기능 중에 이런 식으로 개선할 수 있는 코드가 있을 것 같아서 찾아봤더니 아니나 다를까 있었다.

월별리포트라는 기능을 구현했었는데, 이런 저런 데이터를 처리해서 최종적으로 렌더링에 사용되는 `createReport`(가명) 함수를 이런 식으로 구현했었다.

```javascript
const createReport = async () => {
  const data = {};

  data.a = await createA();
  data.b = await createB();
  //...등등 데이터 할당

  if (someCondition) {
    data.x = await createX();
  } else {
    data.x = null;
  }

  return data;
};
```

오늘 배운 내용을 고려했을 때 위 코드를 아래와 같이 개선하면 다음에 코드를 보는 사람이 더 이해하기 쉽지 않을까 하는 생각이 들었다.

```javascript
const createReport = async () => {
  const data = {
    a: null, // a라는 데이터에 대한 부연설명(필요하다면)
    b: null, // b라는 데이터에 대한 부연설명(필요하다면)
    // ....
    x: null, // x라는 데이터에 대한 부연설명(필요하다면)
  };

  data.a = await createA();
  data.b = await createB();
  //...등등 데이터 할당
  if (someCondition) {
    data.x = await createX();
  }

  return data;
};
```

개선하고보니 data객체를 함수 안에서 선언하기 보다, 데이터 원형이라는 것이 잘 드러나도록 `MonthlyReportDataStructure`같은 느낌으로 선언할 수 있으면 좋겠다는 생각이 들었다.(Swift의 Data Model 같은 느낌?) 잠깐만 근데 TypeScript의 interface가 딱 이런 역할이잖아? 하지만 TS를 쓸 수 없는 환경에서는 interface같은 역할을 하는 구조를 어떻게 짤 수 있을까? 이 부분에 대해서 추가로 고민해보면 좋을 것 같다.(`Object.create`가 강력한 후보가 될 수도 있겠군.)

그리고 최근에 공부한 `Promise.all()`을 사용하는 것도 좋은 방법일 것 같다. 물론 지금은 오래 걸리지 않지만, 나중에 연산해야되는 데이터가 늘어날 수도 있잖아? 히히

생각하다보니 이것저것 꼬리를 물고 또 물고 해서 일단은 여기서 끊고, 다음에 또 이어서 고민을 해보도록 하자.

## 코드에서 맥락 들어내기라는 내용에 대해서 다시 들어봤는데 역시 좋은 내용이다.

이런 얘기다.

한 사람이 작성한 코드를 다른 사람이 이해하는데는 다음과 같은 과정이 존재한다.

`A가 본인의 사고흐름을 추상화해서 코드를 작성` -> `B는 이 코드를 나름의 방식으로 추상화해서 이해`

즉 추상화된 사고를 다른 사람이 또 추상화해서 이해한다는 것.

이 과정의 각 단계에서 맥락이 조금씩 사라진다. (그렇다는 것은 내가 코드를 작성할 때 고려했던 맥락을 코드에 잘 담아낸다 쳐도, 이걸 읽는 사람이 동일한 맥락을 고려해서 이해하리라는 보장이 없어진다는 뜻.)

그렇기 때문에 애초에 맥락이라는 것을 덜어내서 이를 코드에 녹여내는게 가독성이라는 측면에서 도움이 되지 않을까 하는 내용이다.

생각해보면 `no magic number`나, `변수명 잘 짓기`같은 프로그래밍 규칙들도 이런 점에서 BP로 받아들여지지 않나 싶다.

코드를 읽는 사람이 맥락을 고려할 필요 없이 코드만 가지고 의도를 시공간을 건너뛰어서 이해할 수 있도록 하는 것.

요새 이걸 신경쓰고 있긴 한데 사실 잘 안된다. ㅋㅋㅋ...

그래도 의식하는 것과 의식을 하지 않는 것은 다르겠지. 노력해보자. 노력하다보면 깨달음의 순간이 오리라 생각하고..
