# 백엔드는..?

백엔드의 기초는 ‘요청을 받고 → 처리하고 → 데이터를 저장하고 → 응답하고 → 에러 없이 운영할 수 있게 만드는 것’이야.

# 요청을 받는다는 것?

요청을 받는다는 것의 의미에서 내가 놓치고 있거나 공부하면 좋을 내용들에 대해서 알아보자.

우선 요청이 온다는 것은 `클라이언트 - 서버` 구조를 상정한 표현이다.

서로 소통하는 주체가 2개라는 것

클라이언트 - 웹브라우저나 모바일 앱과 같은 요청을 보내는 주체
서버 - 클라이언트가 전송한 요청을 처리하고 응답을 돌려주는 주체

그러면 얘네 둘이서 어떻게 소통하는가??

인터넷 통신을 통해서. 정보통신망 수업 때 배웠던 것처럼 우선 물리적인 매체를 통해서 데이터가 오고 갈 것이고...

어디서부터 어디로 보내야 하는지에 대한 정보는 IP와 같은 주소체계를 사용해서 특정할 것이고,

보통 사람이 사용하는 도메인으로부터 IP주소를 알아내기 위해서 ARP 프로토콜 같은 걸 사용해서 IP주소를 알아내겠지.
-> 조금 잘못 알고 있었음. DNS로부터 google.com과 같은 도메인 이름으로부터 IP주소를 얻어내고, ARP는 그 이후에 IP주소를 실제 기기의 물리주소(MAC주소)로 변환 시에 사용

그래서 해당 IP주소로 클라이언트에서 요청이 서버로 전송되고, 서버에서는 응답 데이터가 클라이언트로 전송된다.

클라이언트와 서버가 데이터를 주고 받을 때, IP 계층 위에서 TCP를 사용해서 데이터가 손실되지 않고 순서대로 도착하도록 보장하고, TCP/IP를 기반으로 HTTP 프로토콜을 사용해서 "어떤 형태"로 요청과 응답을 수행

(TCP는 UDP와 다르게 연결형 프로토콜이기 때문에 실제 데이터가 전송되기 전에 클라이언트와 서버가 3방향 핸드셰이크라는 방식을 활용해서 안정적인 양방향 통신을 구축함, SYN -> SYN/ACK -> ACK)
(TCP를 활용하면 모든 패킷이 순서대로, 오류없이 도착하는 것이 보장되면 패킷이 손실되면 TCP가 재전송을 처리한다.)

전체적인 구조에서 학습이 필요한 키워드는

- 인터넷의 동작 방식(DNS, IP, TCP/IP)
- HTTP(1.1, HTTP/2, HTTPS)
- REST API/GraphQL
- 클라이언트 요청 흐름(브라우저 기준 주소창에 주소 입력 시작하는 시점부터 서버로부터 응답을 받는 시점까지의 처리 과정)

이렇게 클라이언트에서 서버를 특정하고, 정해진 방식(TCP)를 통해서 서버와 연결을 구축하고 이 연결망을 통해서 데이터를 wrapping해서 정해진 형태(HTTP)로 서버 IP주소로 요청을 보낸 이후에는...?

서버에서는 이 요청을 받아서 처리를 해야겠지??

다음 단계를 알아보자.

# 클라이언트에서 요청이 잘 전송되었고 서버에서는 이걸 어떻게 받아서 무엇을 하는가??

지금 문득 드는 의문은, 서버는 어떻게 요청이 도착한걸 인지하지..? 계속 뭔가 listening을 하는건가??? 궁금하네.

무튼 알아보자.

일단 내가 생각했을 때,

- 서버도 하나의 컴퓨터
- 내가 최근에 작성한 fastapi앱도 결국 이 컴퓨터에서 동작하는 프로그램임.
- 컴퓨터에서 프로그램이 동작한다는 건 메모리에 올라가서 실행되고 있다는 것이고
- 그러면 이 백엔드 앱을 실행시키는 로직이 있잖아.
- 예를 들어서

```shell
uvicorn main:app --host 0.0.0.0 --port 8000
```

- 끝에 보면 port를 8000번으로 해서 앱을 실행하고 있음.
- 정보통신망 시간에 배운 내용을 생각해보면, ip주소에 port도 있어서 어떤 port로 최종적으로 요청이 전송되어야 하는지 알 수 있다고 했던 것 같은데 이 부분은 검증이 필요하다.
- 무튼 이렇게 명령어를 실행하면 python 프로세스가 실행되어서, main.py의 app 인스턴스가 메모리에 올라가고, 계속 실행되면서 이벤트 루프가 돌면서 요청 대기함.
- OS한테 8000번 포트 열어주셈~~ 하고 부탁해서 할당받는 개념인 듯.

ip주소에 port정보도 어딘가에 포함되어 있는게 맞나??
-> 노노 아님. https 라는게 443 Port로 고정되어 있다. 즉 https 라는 프로토콜이 port정보를 같이 담고 있음.
-> 이에 대해서는 port가 무엇인지 그리고 어떤 의미를 가지는지 조금 더 공부해보면 좋을 듯.

무튼. 그래 맞다.

서버는 그러면 어찌됐든 OS의 특정 Port로 들어온 TCP 연결 요청을 받아서, 이를 Port에 연결된 웹 서버 애플리케이션에 전달하고 Nginx 같은 웹서버가 이걸 받아서 HTTP 메시지를 parsing 해서 필요한 처리를 수행한다.

이 때 통신용 소켓이 사용된다고 하는데 이 `socket` 이라고 하는게 뭔지도 좀 더 공부가 되면 좋을 듯. -> 별도 문서에 있음 공부 따로 더 해보자.

근데 그러면 Nginx랑 fastapi가 관계가 뭐임 -> 별도 문서에 있음 공부 따로 해보자

어찌저찌 그렇게 해서 나의 fastapi앱으로 요청이 전송되고, 아 이 경로로 들어온 요청이구나 식별해서 특정 router 함수를 실행하고 처리된 결과를 반환해서 데이터를 다시 클라이언트에게 슝!
