# schemaì™€ modelì˜ ì°¨ì´

FastAPI + SQLAlchemy êµ¬ì¡°ì—ì„œ, ìŠ¤í‚¤ë§ˆì™€ ëª¨ë¸ì´ í•¨ê»˜ ì“°ì´ëŠ”ë° ê°ê° ì—­í• ì´ ë­”ì§€ í—·ê°ˆë ¤ì„œ ì°¾ì•„ë´„.

# GPT said..

**ëª¨ë¸**

ì£¼ë¡œ DBì™€ ì—°ê²°ë˜ëŠ” ORM ê°ì²´ë¥¼ ì˜ë¯¸í•¨.(`SQLAlchemy`)

DBì— ì €ì¥ë˜ëŠ” ì§„ì§œ ë°ì´í„° êµ¬ì¡°ë¥¼ ì˜ë¯¸í•œë‹¤. (Table = Model)

```python
class User(Base):
    __tablename__ = "users"

    id = Column(Integer, primary_key=True)
    name = Column(String)
    email = Column(String)
    password = Column(String)
```

**ìŠ¤í‚¤ë§ˆ**

ì…ë ¥/ì¶œë ¥ ë°ì´í„°ì˜ êµ¬ì¡°ë¥¼ ì •ì˜í•œ ê²ƒ. (`Pydantic` ê¸°ë°˜)

APIì—ì„œ ì‚¬ìš©ë  ì…ë ¥/ì¶œë ¥ êµ¬ì¡°ë¥¼ ë¯¸ë¦¬ ì¡ì•„ë‘ê³ , ì´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë°ì´í„° ê²€ì¦ ë° ë³€í™˜ ì²˜ë¦¬

```python
# schemas.py
class UserCreate(BaseModel):
    name: str
    email: str
    password: str  # APIë¡œ ë°›ì„ ë• ìˆì–´ì•¼ í•¨

class UserRead(BaseModel):
    id: int
    name: str
    email: str  # ë¹„ë°€ë²ˆí˜¸ëŠ” ë¹¼ê³  ì‘ë‹µ!
```

---

ë¶„ë¦¬í•˜ëŠ” ì´ìœ ê°€ ë­”ì§€..?

- ì±…ì„ë¶„ë¦¬: DBì„¤ê³„ëŠ” ëª¨ë¸, APIì„¤ê³„ëŠ” ìŠ¤í‚¤ë§ˆ.
- ìœ ì—°ì„±: ìŠ¤í‚¤ë§ˆëŠ” ë‹¤ì–‘í•œ ë³€í˜•ì„ ë§Œë“¤ ìˆ˜ ìˆìŒ(Createìš©, Readìš©, Updateìš© ë“±ë“±)
- ë³´ì•ˆ: DBì— ì €ì¥ëœ ì •ë³´ì™€, ì‹¤ì œ API in/out ì •ë³´ê°€ ë‹¤ë¥¸ë° ì´ ê³¼ì •ì—ì„œ ì •ë³´ë¥¼ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬í•˜ëŠ”ë° ë„ì›€ë¨(ë¹„ë°€ë²ˆí˜¸ê°€ DBì— ìˆì–´ë„ ì‘ë‹µì—ëŠ” í¬í•¨ì‹œí‚¤ì§€ ì•ŠëŠ”ë‹¤ë˜ì§€ í•˜ëŠ”...)

# Schema

ìŠ¤í‚¤ë§ˆëŠ” ë°ì´í„°ì˜ êµ¬ì¡°ì™€ ìœ íš¨ì„±ì„ ì •ì˜
-> validationê³¼ serializationì— ì‚¬ìš©ë¨.

í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ì „ì†¡ëœ inputì„ ê²€ì¦í•˜ê³ , í•„ìš”í•˜ë©´ í˜•ì‹ì„ ë³€í™˜í•´ì„œ Modelì— ì‚½ì… ê°€ëŠ¥í•œ í˜•íƒœë¡œ ì¤€ë¹„í•œë‹¤.

ì´ ë‹¨ê³„ì—ì„œ ì—¬ëŸ¬ê°€ì§€ ë°ì´í„° ìœ íš¨ì„± ê²€ì‚¬ ê·œì¹™ì„ ì„¤ì •í•  ìˆ˜ ìˆìŒ.

ë³´í†µ DBìŠ¤í‚¤ë§ˆì™€ ì§ì ‘ì ì¸ ì—°ê´€ì´ ì—†ê³ , DBì— ë°ì´í„° ì €ì¥í•˜ê¸° ì „ì— ë°ì´í„° ì •ë¦¬í•˜ê³  ì¤€ë¹„í•˜ëŠ” ì—­í• ì„ í•œë‹¤.

User Input -> HTTP Request -> FastAPI -> Pydantic Schema -> Model -> DB ì´ëŸ° ìˆœì„œì¼ë ¤ë‚˜ ëŒ€ì¶©?

(gptí•œí…Œ ë¬¼ì–´ë³´ë‹ˆ ì´ë ‡ê²Œ ì•Œë ¤ì¤Œ)

ğŸ‘¤ User Input (ë¸Œë¼ìš°ì €, ì•±)
â†“ <br/>
ğŸŒ HTTP Request (JSON)
â†“ <br/>
âš™ï¸ FastAPI Route (@app.post)
â†“<br/>
ğŸ“¦ Pydantic Schema (UserCreate)
â†“ <br/>
ğŸ§Š SQLAlchemy Model (User ê°ì²´ ìƒì„±)
â†“ <br/>
ğŸ’¾ DB (SQLite, PostgreSQL ë“±)

ë°ì´í„°ë¥¼ ê·¸ ì•ë‹¨ì—ì„œ í•„ìš”í•œ ì²˜ë¦¬ë¥¼ í•˜ë ¤ê³  í•˜ë‚˜ì˜ ë‹¨ê³„ë¥¼ ë§Œë“ ê±°êµ¬ë‚˜.

DBì˜ êµ¬ì¡°ì— ëŒ€í•œ ëª…ì„¸ -> Model
ë‚´ê°€ ì•± ë‚´ì—ì„œ í•„ìš”í•œ dataì˜ êµ¬ì„±ì— ëŒ€í•œ ëª…ì„¸ -> Schema

# Model

DBì˜ ì‹¤ì œ í…Œì´ë¸”ê³¼ `ë§¤í•‘`ë¨.

Mapping ë˜ë ¤ë©´ ì–´ì¨Œë“  êµ¬ì¡°ê°€ DBêµ¬ì¡°ë¥¼ resemble í•´ì•¼ê² ì§€??

DBì— ì‹¤ì œ ì €ì¥ë˜ëŠ” ë°ì´í„°ë¥¼ ë‚˜íƒ€ë‚´ë©°, DBì™€ì˜ ìƒí˜¸ ì‘ìš©ì„ ê´€ë¦¬í•˜ê³  CRUD ì‘ì—…ì„ ìˆ˜í–‰.

ëª¨ë¸ ê°ì²´ëŠ” ìŠ¤í‚¤ë§ˆë¡œë¶€í„° ìƒì„±ëœ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìƒì„±ëœë‹¤..?

í´ë¼ì´ì–¸íŠ¸ê°€ ë³´ë‚¸ JSONì„ ê¸°ë°˜ìœ¼ë¡œ FastAPIê°€ `Pydantic` ìŠ¤í‚¤ë§ˆë¡œ íŒŒì‹±í•˜ê³ , ì´ê±¸ ê¸°ë°˜ìœ¼ë¡œ SQLAlchemy ëª¨ë¸ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•¨.

ì´ ëª¨ë¸ ì¸ìŠ¤í„´ìŠ¤ëŠ” DBì¡°ì‘ì´ ê°€ëŠ¥í•˜ë‹¤.(CRUD)

`ìŠ¤í‚¤ë§ˆëŠ” ë‹¨ì§€ ê°’ë§Œ ë‹´ê³  ìˆëŠ” ê²€ì¦ìš© ê°ì²´ê³ , ëª¨ë¸ì€ ê·¸ ê°’ë“¤ì„ ë°”íƒ•ìœ¼ë¡œ ë§Œë“¤ì–´ì§„, DBì— ì—°ê²°ë¼ì„œ ë™ì‘í•  ìˆ˜ ìˆëŠ” 'ì§„ì§œ ì‚´ì•„ìˆëŠ”' ê°ì²´ì•¼.`

# ê²°ë¡ 

ê°€ì¥ ê°„ë‹¨í•˜ê²Œ ë§í•˜ë©´,

- Modelì€ DB í…Œì´ë¸”ì— ëŒ€í•œ ëª…ì„¸ì„œ, SchemaëŠ” API ì…ì¶œë ¥ ë°ì´í„°ì— ëŒ€í•œ ëª…ì„¸ì„œ
- Schemaë¥¼ ê¸°ë°˜ìœ¼ë¡œ DBì— ë°ì´í„°ë¥¼ ì‚½ì…í•˜ëŠ”ë° ì‚¬ìš©ë˜ëŠ” Model instanceë¥¼ ìƒì„±
  - SchemaëŠ” DBì— ë°ì´í„°ë¥¼ ë„£ê¸° ì „ì— í•„ìš”í•œ ì „ì²˜ë¦¬ ê°™ì€ ê²ƒë“¤ì„ ë‹´ë‹¹.(ê²€ì¦ê³¼ ë³€í™˜)

# ì¶”ê°€ ì •ë³´

FastAPIì—ì„œëŠ” `SQLAlchemy model class`ë¥¼ `Pydantic Schema`ì™€ ë¶„ë¦¬í•˜ëŠ” ê²ƒì´ conventionì´ë¼ê³  í•¨.

ì•ì„œ ê³µë¶€í–ˆë“¯ì´,

- model -> only used for defining the DB Schema
- schema -> used for validating incoming and outgoing data in CRUD functions and path operations. (pydantic ìŠ¤í‚¤ë§ˆëŠ” ë°ì´í„° ìœ íš¨ì„± ê²€ì‚¬(API Serializer)ì™€ ë°ì´í„° êµ¬ì¡° ì •ì˜(Data Class) ì—­í• ì„ ì–´ëŠì •ë„ ë™ì‹œì— ìˆ˜í–‰í•˜ëŠ” hybrid ëŠë‚Œì“°?)
- ë¶„ë¦¬í•˜ë©´ ì¢‹ì€ ì´ìœ  ì¤‘ í•˜ë‚˜ëŠ”, ì„œë¡œ ë‹¤ë¥¸ CRUD operationì— ëŒ€í•´ì„œ ì„œë¡œ ë‹¤ë¥¸ ìŠ¤í‚¤ë§ˆë¥¼ ì •ì˜í•  ìˆ˜ ìˆìŒ.
